name: $(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)

trigger:
  batch: true
  branches:
    include:
    - master
    - release/*
    - hotfix/*
  paths:
    exclude:
    - documentation/*
    - LICENSE
    - README.md
    - CHANGELOG.md
    - TESTING.md
    - CONTRIBUTING.md
    - .mailmap
    - .rubocop.yml
    - .gitignore
    - chefignore

pr:
  branches:
    include:
    - master
    - release/*
  paths:
    exclude:
    - documentation/*
    - LICENSE
    - README.md
    - CHANGELOG.md
    - TESTING.md
    - CONTRIBUTING.md
    - .mailmap
    - .rubocop.yml
    - .gitignore
    - chefignore

resources:
  repositories:
  - repository: templates
    type: git
    name: chef-pipelines-templates

variables:
  group: Xcode URLs

jobs:
${{ if eq(platform, 'sierra') }}
  - script: echo '##vso[task.setvariable variable=XCODE_URL]$(XCODE_STORAGE)/Xcode_9.3.dmg'
${{ if ne(platform, 'sierra') }}
  - script: echo '##vso[task.setvariable variable=XCODE_URL]$(XCODE_STORAGE)/Xcode_10.1.dmg'

- template: common.yml@templates
  parameters:
    kitchenFile: kitchen.yml
    platforms:
    - sierra
    - high-sierra
    - mojave
    suites:
    - certificate
    - command-line-tools
    - default
    - delete-users
    - keychain
    - power-management
    - remote-access
    - software-updates
    - spotlight
    - users
    - xcode-from-apple
    - xcode-from-url
    chefVersion:
    - chef14
